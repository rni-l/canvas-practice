# 拼图小游戏

> 有个 H5 项目，要做一个拼图的小游戏，这里大概记录下。

因为是用 vue 开发的项目（整个项目不单单只有拼图游戏），所以 demo 也是用 vue 的。

需求：

一个正方形，有 8 块图形，通过拖动，拼成一幅正确的画。这是用 canvas 做的。

点击 canvas 时，判断点击的位置是哪块拼图（我觉得这是整个最关键的步骤）。

主要流程：

1. 初始化，生成 8 块拼图
2. touchstart，根据点击位置，判断点到哪一块拼图，这块拼图可以往哪个方向移动
3. touchmove，移动拼图
4. touchup，判断拼图是否超过了某个值
   1. 是，移动到原本的空位置上
   2. 否，移动到原来的位置

## 初始化

这是一个 9 宫格，总共有 16 个点。先获取 16 个点的坐标，再缓存 9 个格子，四个顶点的坐标。最后生成 8 个拼图对象，记录它们的位置。

保存空位置的 index。

## 获取点击目标和移动方向

移动前，就可以根据点击时的拼图 index 和空位置的 index 进行比较，就知道这块拼图可以往哪个方向移动。

而获取点击目标，是用面积计算判断。遍历每个矩形，矩形的四个顶点连接点击的点，形成的三角形总面积，如果大小或小于（可能有小数点误差）矩形的面积，证明点击的模板是在这个矩形上。

## touchend

手指放开后，根据移动的距离，判断复位的方向和坐标。更新新的空位是哪个，修改移动的拼图的 index 值为原本的空位值。